# Courier Service

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—É—Ä—å–µ—Ä–∞–º–∏ –∏ –¥–æ—Å—Ç–∞–≤–∫–∞–º–∏.  
–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –Ω–∞ Go —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º PostgreSQL, Kafka, Prometheus –∏ Grafana.

–ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è —É—á–µ–±–Ω–æ–π –∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–π –æ—Ç—Ä–∞–±–æ—Ç–∫–∏:
- —á–∏—Å—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã,
- —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è,
- –º–µ—Ç—Ä–∏–∫ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞,
- rate limiting,
- CI/CD,
- –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è (pprof).

---

## üöÄ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### –ö—É—Ä—å–µ—Ä—ã
- –°–æ–∑–¥–∞–Ω–∏–µ –∫—É—Ä—å–µ—Ä–∞
- –ü–æ–ª—É—á–µ–Ω–∏–µ –∫—É—Ä—å–µ—Ä–∞ –ø–æ ID
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫—É—Ä—å–µ—Ä–∞
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫—É—Ä—å–µ—Ä–æ–≤
- –ü–æ–∏—Å–∫ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –∫—É—Ä—å–µ—Ä–∞

### –î–æ—Å—Ç–∞–≤–∫–∞
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –∫—É—Ä—å–µ—Ä—É
- –°–Ω—è—Ç–∏–µ –∑–∞–∫–∞–∑–∞ —Å –∫—É—Ä—å–µ—Ä–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –∫—É—Ä—å–µ—Ä–æ–≤ –ø–æ –¥–µ–¥–ª–∞–π–Ω—É

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- HTTP Gateway –¥–ª—è Order Service
- Kafka consumer –¥–ª—è —Å–æ–±—ã—Ç–∏–π –∑–∞–∫–∞–∑–æ–≤
- Prometheus-–º–µ—Ç—Ä–∏–∫–∏
- Rate Limiter (Token Bucket)

---

## üß± –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü—Ä–æ–µ–∫—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º **Clean Architecture**:

cmd/
myapp/ // —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
internal/
courier/ // –∫—É—Ä—å–µ—Ä—ã (handler, usecase, repository)
delivery/ // –¥–æ—Å—Ç–∞–≤–∫–∞ (handler, usecase, repository)
gateway/ // HTTP gateway –∫ order-—Å–µ—Ä–≤–∏—Å—É
middleware/ // middleware (metrics, rate limit)
metrics/ // prometheus-–º–µ—Ç—Ä–∏–∫–∏
worker/ // Kafka consumer
db/ // —Ä–∞–±–æ—Ç–∞ —Å –ë–î
pkg/
logger/ // –ª–æ–≥–≥–µ—Ä

---

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- Go 1.21+
- PostgreSQL (pgx)
- Kafka (sarama)
- Prometheus + Grafana
- golangci-lint
- Goose (–º–∏–≥—Ä–∞—Ü–∏–∏)
- net/http/pprof

---

## ‚öôÔ∏è –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–∞–π–ª `.env`:

‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

make run

üóÑ –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î

make migrate          # –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
make migrate-down     # –æ—Ç–∫–∞—Ç–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–≥—Ä–∞—Ü–∏—é
make migrate-status   # —Å—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–π
üß™ –¢–µ—Å—Ç—ã
go test ./... -v
üßπ –õ–∏–Ω—Ç–∏–Ω–≥
golangci-lint run ./...
–∏–ª–∏ —á–µ—Ä–µ–∑ Makefile (–µ—Å–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω–æ):

make lint
üìä –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
Prometheus
bash
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
GET /metrics
–ü—Ä–∏–º–µ—Ä—ã –º–µ—Ç—Ä–∏–∫:

HTTP latency

–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤

Rate limit exceeded

Gateway retries

üî• Rate Limiting
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Token Bucket:

–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ RPS

–í–æ–∑–≤—Ä–∞—Ç 429 Too Many Requests

–ó–∞–≥–æ–ª–æ–≤–æ–∫ Retry-After

üß† –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ (pprof)
–û—Ç–¥–µ–ª—å–Ω—ã–π HTTP-—Å–µ—Ä–≤–µ—Ä (—Ç–æ–ª—å–∫–æ localhost):

http://127.0.0.1:6060/debug/pprof/

–ü—Ä–∏–º–µ—Ä—ã:

go tool pprof http://localhost:6060/debug/pprof/profile?seconds=10
go tool pprof http://localhost:6060/debug/pprof/heap

üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
pprof –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ —Å localhost

–ù–µ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ —Å–Ω–∞—Ä—É–∂–∏

ü§ñ CI/CD
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è GitHub Actions:

golangci-lint

go test

go build

Workflow: .github/workflows/ci.yml

üìå –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ
–í—Å–µ —Å–ª–æ–∏ –ø–æ–∫—Ä—ã—Ç—ã unit-—Ç–µ—Å—Ç–∞–º–∏

Gateway –ø–æ–∫—Ä—ã—Ç retry-—Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏

–ú–µ—Ç—Ä–∏–∫–∏ —Ç–µ—Å—Ç–∏—Ä—É—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ

–ö–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º golangci-lint v2

üìö –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
–£—á–µ–±–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –¥–ª—è –ø—Ä–∞–∫—Ç–∏–∫–∏ backend-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞ Go:

–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞,

–∫–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞,

–Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å,

—ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è.
